≪ゴーストエクスプローラ通（β版）≫ ver 0.4.0

顔画像・立ち絵表示付きのゴーストエクスプローラです。
絵を見ながらゴーストの切り替えや呼び出しを行うことができます。

・まだ試作段階のため、不具合が多数存在する可能性があります。

・立ち絵の生成処理を独自エンジン（仮称：偽SERIKO）で実装しているため、
  ゴーストによっては立ち絵を正しく表示できないかもしれません。
  もし表示できないゴーストがいたらご連絡ください。対応できそうであれば対応します。
  (ゴースト側の立ち絵定義内容が著しく仕様に沿っていないような場合は、対応しない場合があります)

作者: ポン
Twitter: https://twitter.com/tetradice
Ukadon: https://ukadon.shillest.net/web/accounts/29648
ソース (Github) : https://github.com/tetradice/ukagaka_explorer2

****************

■動作詳細

・ゴースト側でのシェル変更、着せ替え変更の内容も反映されます。

・プラグインとしてSSPから呼び出す以外に、ゴーストエクスプローラ通を最初に起動して、その後でSSP内の好きなゴーストを呼び出すこともできます（先行起動モード）。

  ゴーストエクスプローラ通の「オプション」を選択し、「Windows スタートメニューにゴーストエクスプローラ通を登録」というボタンを押してください。
  そうすると、Windowsスタートメニューからゴーストエクスプローラ通を起動することができるようになります。
  ※SSP.exe の場所を別のフォルダに移動した場合は、再度登録を行うようにしてください
  
  なお、Windowsスタートメニューへの登録時に、アイコンがWindows標準のものになりますが
  これはバグではありません。（独自のアプリアイコンを用意できていないだけです）



■動作詳細（ゴースト作者さん向け）

・ゴーストのフォルダに ghost\master\explorer2\character_descript.txt を置くと、ゴースト選択時に、そのテキストファイルの内容を
  ゴーストの説明文として表示します。キャラクター紹介のようなノリで書いてください。

    ※テキストファイルのエンコーディングは【UTF-8】である必要があります
      （シフトJISは不可であることに注意してください）

・起動時に、ゴースト側で OnGhostExplorer2Open イベントを発生させます。（Referenceなし）

・特に指定がなければ、通常は0番, 10番のサーフェスを立ち絵として表示しようとします。
  他の番号(ID)のサーフェスを表示させたい場合は、下記のどちらかでデフォルトサーフェスIDを指定してください。
  
    ・ghost\master\explorer2\descript.txt を作成し、その中で下記のように指定　　※ゴーストエクスプローラ通でのみ有効
        
        sakura.defaultsurface,100
        kero.defaultsurface,200
        
    ・ghost\master\descript.txt の中で下記のように指定　　※SSP、ゴーストエクスプローラ通の両方で有効
        
        sakura.seriko.defaultsurface,100
        kero.seriko.defaultsurface,200

・シェルのフォルダ内に explorer2\descript.txt を置き、下記のように記載すると、
  「立ち絵画像のうち、どこからどこまでの範囲を顔画像として表示するか」を指定することができます。
  （マスターシェルの場合なら、shell\master\explorer2\descript.txt に置いてください）
  
    face.left,28
    face.top,28
    face.width,192
    face.height,160

  left, topで左上原点を指定し、width, heightで幅と高さを指定します。
  width, heightの比率は、できる限り「6:5」となるようにしてください。
  （実際に表示する顔画像のサイズは、幅120px × 高さ100pxです）



■現時点での制限事項

・ゴーストの切り替え時や呼び出し時には、イベントトーク (OnGhostChanging, OnGhostCalling) が発生しますが、
  これはSSP本体の動作を、仕様書などを元に模倣したものなので、SSP側で切り替えた時の動作と微妙に差があります。
  （たとえば、SHIORIがOnGhostChangingに反応しなかった場合、SSPであれば代わりにOnCloseイベントを発生させますが
  　ゴーストエクスプローラ通では技術的な制約で、この処理を行えません）

・SERIKOの描画メソッドのうち、正しく処理できるのは、基本的な重ね合わせメソッド (base, overlay, overlayfast, add, bind) 、および reduce, interpolate のみです。
  他の描画メソッドはすべてoverlay扱いで描画します。

・SERIKOの機能のうち、下記のものには対応できていません。
  ・animation*.option,background



■今後実装したい機能

・ゴーストデベロッパー向けモード（右クリックメニューからゴーストのフォルダを開くことができるとか）

・シェルの読み込みと立ち絵描画部分をライブラリとして切り出して、個別配布できるようにする

・バルーンエクスプローラ通



■ライセンス（利用条件）

ゴーストエクスプローラ通を再配布する場合、変更なしでの再配布は個人/商用を問わず、自由に行っていただくことが可能です。

一部流用や改変などを行う場合の条件は、ゴーストエクスプローラ通の中に含んでいるライブラリの条件に従います。
詳細は同梱の license.txt を参照してください。



■更新履歴

2020/6/xx ver 0.4.0 β版リリース

* [機能追加] SSPを立ち上げていない状態で、ゴーストエクスプローラ通を単体起動できるようにした（先行起動モード）
* [機能追加] 並び順に「最近インストールした順」を追加
* [機能追加] SERIKOのreduce, interpolateメソッドに対応
* [機能追加] ゴースト側の explorer2\descript.txt でもデフォルトサーフェスIDを指定できるようにした
* [変更] ゴースト切り替え時や呼び出し時のトークが発生するようにした
* [変更] 立ち絵を表示できない場合のエラーメッセージを、以前より具体的に表示するようにした
* [変更] ゴーストエクスプローラ通がサポート対象外とするゴーストの場合、「ERROR: 〜」ではなく「UNSUPPORTED: 〜」形式でメッセージを表示するように変更
         現時点では下記のものが該当
           - シェルが1つもないゴースト
           - 暗号化PNG (拡張子が .dap, .ddp, .dfp, .dgp 形式の画像ファイル) を使っているゴースト
           - sakura側のデフォルトサーフェス (通常はID=0、descript.txtの記載により変更可) が存在しないゴースト
           - pngとpnaのサイズが異なり、かつ縦幅と横幅が矛盾している (片方は大きいのに片方は小さい) ゴースト
* [変更] ゴースト側 descript.txt で seriko.defaultsurfacedirectoryname を指定している場合に、動作に反映されるようにした

* [修正] ゴースト名検索の実行時に、ゴーストが1体も見つからなかった場合にシステムエラーで落ちる不具合を修正
* [修正] 起動中のゴーストを終了させ、ゴーストが不在から不在でない状態に戻った時に、起動中のシェル・着せ替え変更が反映されない不具合を修正
* [修正] 一部ゴーストの立ち絵を正しく処理できない不具合を修正
           - intervalにalwaysが指定されているアニメーションを処理できていなかった
           - サーフェスID=0にエイリアスを指定しているシェルを、正しく処理できていなかった
           - 着せ替えのaddid指定を正しく処理できていなかった
           - 着せ替えの座標指定が正しく反映されない場合があった
           - 着せ替えで2つのサイズが異なるサーフェスを重ねた時に、透明色部分の透過処理が正しく行われない場合があった
           - shell\master が存在しない場合も正しく処理できるようにした（仕様上は不正だが、SSPは正常に表示できる）
           - pngとpnaのサイズが違っていても正しく処理できるようにした（仕様上は不正だが、SSPは正常に表示できる）
           - surfaces.txt 内で、offsetX, offsetYに数値でない値（不正値）が設定されている場合にも正しく処理できるようにした

* [内部的変更] β版リリースに伴い、プラグインのファイル構成を変更
* [内部的変更] ライセンス（利用条件）を整備して、本体部分はNYSLで自由に再配布・再利用できるようにした（添付ライブラリ MagickK.NET を除く）


2020/5/27 ver 0.3.1
* [修正] 起動直後に不在表示が正しく行われていなかった不具合を修正
* [修正] 一部ゴーストの立ち絵を正しく処理できない不具合を修正
           - 1つの surfaces.txt 内に、SERIKO V1, V2の記述形式が混在していても正しく処理できるようにした（仕様上は不正だが、SSPは正常に表示できる）
           - surfaces.txt 内で、1つのサーフェス定義内に "element0" が複数記述されている場合にも
             正しく処理できるようにした（仕様上は不正だが、SSPは正常に表示できる）
* [修正] "[ ametone ]" のように、ゴースト名の中に[]記号が含まれるゴーストへの切り替えや呼び出しが行えない不具合を修正


2020/5/24 ver 0.3.0
* [機能追加] 並び順の変更を行えるようにした（名前順/最近起動した順/累計起動時間順）
* [機能追加] ゴースト名による検索を行えるようにした
* [機能追加] SSP側で2つ以上のゴーストフォルダを登録している場合、どのフォルダのゴーストを表示するか選択できるようにした
* [変更] 高速化のため、起動直後には最低限のゴースト情報だけを読み込み、シェル情報の読み込みや顔画像の生成はそのあとに随時行うようにした
         (大量にゴーストをインストールしている環境向けの改良)
* [変更] 前回終了時のウインドウサイズを復元するようにした
* [変更] その他細かい変更


2020/5/20  ver 0.2.0
* [機能追加] explorer2\character_descript.txt をゴーストフォルダに置くことで、ゴーストの説明文を表示できるようにした
* [機能追加] explorer2\descript.txt をシェルフォルダに置くことで、顔画像の表示範囲を指定できるようにした

* [変更] SSP上で起動中のゴーストについては、顔画像や立ち絵を表示しないようにした（不在表示）
* [変更] ゴーストエクスプローラ通を呼び出したゴーストを切り替えた or 終了した後でも、ゴーストの呼び出しを行えるようにした
            - SSP自体を終了させている場合、SSP.exeを再度立ち上げてゴーストを呼び出す
* [変更] ゴーストエクスプローラ通を呼び出したゴーストを切り替えた or 終了した際、それを自動的に検知して、ゴースト切替ボタンを押下不可にするようにした
* [変更] 立ち絵画像の2回目以降の表示を高速化するようにした（1回目の表示時にキャッシュして、2回目以降の表示で使い回すようにした）
* [変更] その他細かい変更

* [修正] 一部ゴーストの立ち絵を正しく処理できない不具合を修正
           - elementの処理順がSSPと異なっていた (修正前: IDの昇順 → 修正後: surfaces.txt 内に書いた順)
           - 一部ゴーストの立ち絵で、elementや着せ替えパーツについて意図しない拡大縮小が行われる場合があった
           - 通常の立ち絵画像やelementが存在せず、animationの組み合わせのみで立ち絵を生成しているシェルを処理できなかった
           - 複数枚のelementや着せ替え画像を組み合わせて、2枚目以降の画像が1枚目のサイズより大きくなる（はみ出る）場合に正しく処理できなかった
           - ゴースト側 descript.txt の、sakura.seriko.defaultsurface, kero.seriko.defaultsurface の指定を見ていなかった


2020/5/17  ver 0.1.1
* [修正] surfaces.txt の記述によっては、読み込み時にエラーで落ちることがある不具合を修正


2020/5/17  ver 0.1.0
* α版公開